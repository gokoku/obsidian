#raspberry_pi  #watson  #node-red 

---
2023-03-13

# 遠野音声認識AIシステム

AIを使った実証実験として、音声を使えば顧客にリーチしやすいのではないかとの提案から音声認識を使って会話が出来るようなシステムの制作を行った。


## システム構成
![[Pasted image 20220329135704.png]]

Raspberry Pi をメイン処理装置にして、音声の入力・出力の制御を行い、 IBM の Watson による AI 音声認識機能を活用する構成とした。

また、人の接近を赤外線センサーの入力トリガーとして検知し、会話時のインタフェースとしてテープLEDの制御をする。

マルチプル双方向コンバータは、Raspberry PI の入力・出力の3.3 V を、テープLED の制御信号の 5V に合わせるために咬ませている。



## Node-RED のフロー概略
![[Pasted image 20220329142848.png]]

Node-red をプラットフォームにして、watson との接続、マイク入力とスピーカー制御する shell script の駆動をする。

このフローのスタートトリガーは、赤外線センサーによる検出シグナルを使った。

また、音声入力状態とWatson の処理と通信の待機状態をわかり易くするインタフェース補助としてテープLED を使った。

## フローのスタートトリガー
焦電型赤外線センサーを使って近接検知を実装した。
検知シグナルが ON になった時、フローがスタートする。
ON になったのを見てわかるように赤いLEDが点灯するようにした。

一度フローに入ったら抜けるまでロックをかけてトリガーが入っても弾くようにした。
ロックが掛かってるのを見てわかるように緑のLEDが点灯するようにした。

![[IMG_0626.png]]



## テープLED を使った補助インタフェース

今音声入力状態なのか、Watson の処理と通信の待機状態なのかわからないので、テープLED を使った光り方のパターンを作り、それで表すようにした。

![[IMG_0627 1.png]]


##### 聴いてるときモード
![[Pasted image 20220329162947.png]]

何個かの光が移動して端っこに来たら跳ね返るパターン。


##### Watson 考え中モード
![[Pasted image 20220329163920.png]]

全体でゆっくり明滅するパターン。青系。

これらテープLEDの回路実装とプログラムを以下にまとめました。

[[raspberry_pi  遠野AI テープLED の実装とプログラム]]


## Watson のプログラミング

AI の音声認識機能は IBM の Bluemix のサービスを使って実現することにした。

今回使用したサービスは、「Speech to Text-0i」と「Watson Assistant-2s」で以下のものとなります。
* Speech to Text-0i  : 音声からテキストを抽出する
* Watson Assistant-2s : AI主導の会話型のフローを作成する

今回の作成したシステムでは、大雑把に

1. Raspberry pi でユーザーの声を録音して、Bluemixのサービス「Speech to Text-0i」に送り、テキストを受け取る。
2. テキストデータを「Watson Assistant-2s」の入力にして、予めプログラムした会話型フローに沿って対応したテキストを受け取り、Raspberry pi で音声合成変換をしてスピーカーから音声を流す。


今回のシステムにおける主要機能部は「Watson Assistant-2s」であり、その肝の部分は会話型フローをプログラムするダイアログの設計になります。



# watson  遠野AI のダイアログ設計

Watson のAssistant のダイアログの設計は柔軟性が高いので、設計を収束させるために現段階での理解の元、今のシステム条件で考え方を決めていった。

## Raspberry pi のシステム設計による特殊性
Watson Assistants は基本的にテキストベースのチャットアプリにおいてうまく機能出来るようになっている。

![[Pasted image 20220325163454.png]]

今回の raspberry pi をハードとLinux OSをプラットフォームにして設計したシステムでは、音声を Watson の外で取って入力にするため、一問一答で終了させる必要があった。


![[Pasted image 20220325164318.png]]


以上から一問一答的パターンを何個か用意するシンプルな形を Watson Assistants を基本設計とした。

## Assistants の設計

### Assistants の概略
今回の目的のために必要なスキルは会話型の Dialog Skill だけをリンクした。

![[Pasted image 20220325133707.png]]

Dialog Skill とは対話型の仕組みを持つもので、Intents と Entities と Dialog で構成されている。


![[Pasted image 20220325134310.png]]

Dialog は対話フローを作るもので、Intents は粒度大きめの「ユーザーの目的」を担当し、Entities は粒度の小さい「言葉」を担当し、言い換えとか類義語などを吸収させることができる。

![[Pasted image 20220325145909.png]]


# 現地への設置

![[Pasted image 20230314173905.png]]

パネルに合わせて竿に見立てたマイクスタンドを設置した。

# 課題

以上を持って、遠野音声認識AIシステムの完了としました。

課題としては、設計が始まったときの無料で使えるAIシステムのパラダイムが昨今のシステムに比べて世代が古いものであったので応答にかなりのタイムラグが発生している。

ここ最近のAIのパラダイムが大変化の渦中にあり、今後有料であればかなりのパフォーマンスが期待されると思われる。