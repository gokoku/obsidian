---
type: note
---


---
2022-12-19  16:11

# リアルタイム配信システム調べる

https://ygoto3.com/posts/live-streaming-and-rtmp-for-frontend-engineers/

RTMP ストリーミング配信に Docker で NGINX を立ててる。

RTMP プレイヤーは Flash アプリケーション
ブラウザでは Flash が必要らしい。

RTMP/RTMPT は 2020年末でサポートが終了したそうだ。

現在主流は HLS とのこと。
Http Live Streaming


<div class="rich-link-card-container"><a class="rich-link-card" href="https://n-v-l.co/blog/hls-streaming" target="_blank">
	<div class="rich-link-image-container">
		<div class="rich-link-image" style="background-image: url('https://storage.googleapis.com/studio-cms-assets/projects/moWvdvrgq6/s-740x493_v-fs_webp_45be703e-567c-47ef-b7a5-b646d4d76c33.jpg')">
	</div>
	</div>
	<div class="rich-link-card-text">
		<h1 class="rich-link-card-title">HLSストリーミングの特徴や仕組み・配信方法をプロがまとめてみた  | NOVEL株式会社</h1>
		<p class="rich-link-card-description">
		HLSストリーミングとは、オンデマンド配信やライブ配信などの動画配信を手軽に行えるシステムです。端末の容量を使わず、ネット上で配信・視聴が行えるシステムは、配信者とユーザーともに利用のメリットがあります。この記事では、HLSストリーミングについて以下の点を解説します。HLSストリーミング配信のメリットHLSストリーミングを使用した動画配信には、以下の4つのメリットがあります。すぐに再生できる長時間...
		</p>
		<p class="rich-link-href">
		https://n-v-l.co/blog/hls-streaming
		</p>
	</div>
</a></div>

HLS でライブ配信をすると、遅延時間が長くなるらしい。



Firefox で使えるダウンロードソフトは、Video DownloadHelper VideoProcConverter

Convertio はオンラインHLS変換サイト




<div class="rich-link-card-container"><a class="rich-link-card" href="https://www.alpha.co.jp/blog/202201_02" target="_blank">
	<div class="rich-link-image-container">
		<div class="rich-link-image" style="background-image: url('https://www.alpha.co.jp/blog/static/032ebac5295df8da183cf3ab0b62b21c/90823/cover.png')">
	</div>
	</div>
	<div class="rich-link-card-text">
		<h1 class="rich-link-card-title">HLSによる社内向け動画配信 - アルファテックブログ</h1>
		<p class="rich-link-card-description">
		OBS StudioとWebサーバーを使用して、外部サービスを利用せずに動画を生配信する方法を紹介します。
		</p>
		<p class="rich-link-href">
		https://www.alpha.co.jp/blog/202201_02
		</p>
	</div>
</a></div>


HLS は「メディアセグメント」「再生リスト」ファイルを Webサーバで公開することで配信を実現しているとのこと。


<div class="rich-link-card-container"><a class="rich-link-card" href="https://www.re-d.jp/news/article/8426/" target="_blank">
	<div class="rich-link-image-container">
		<div class="rich-link-image" style="background-image: url('https://www.re-d.jp/uploads/2022/03/aa-1200x630.jpg')">
	</div>
	</div>
	<div class="rich-link-card-text">
		<h1 class="rich-link-card-title">2022年版　HTTP Live Streaming（HLS）のやり方｜Re:design News</h1>
		<p class="rich-link-card-description">
		Appleさんが開発したHTTP Live Streaming（以下、HLS）を活用すると難しい設定なしで、しかも既存のサーバーで簡単にストリーミングが実現できるって聞いたけどマ？って思ってるアナタがたどり着いた記事がこちらです。お疲れ様です！ Content...
		</p>
		<p class="rich-link-href">
		https://www.re-d.jp/news/article/8426/
		</p>
	</div>
</a></div>

hls.js のダウンロード
https://github.com/video-dev/hls.js/tags

```HTML
<video id="v" controls autoplay muted playsinline loop></video>
<script src="hls.js"></script>

<script>
var video = document.getElementById('v');
var videoSrc = 'mv.m3u8';
if (video.canPlayType('application/vnd.apple.mpegurl')) {
	video.src = videoSrc; //iOS等 } else if (Hls.isSupported()) { var hls = new Hls(); hls.loadSource(videoSrc); hls.attachMedia(video); 
	}
</script>
```

動画ファイル(mp4 など)をHLS形式に変換すると、
1. プレイリストファイル(.m3u8)
2. 分割された動画ファイル(.ts)

これを HTMLファイルにhls.js と一緒に置いとくらしい。
これを apache nginx に配置する。

https://mat0401.info/blog/brief-hlsjs1/


<div class="rich-link-card-container"><a class="rich-link-card" href="https://mat0401.info/blog/brief-hlsjs1/" target="_blank">
	<div class="rich-link-image-container">
		<div class="rich-link-image" style="background-image: url('https://mat0401.info/wp-content/uploads/2020/06/movie.png')">
	</div>
	</div>
	<div class="rich-link-card-text">
		<h1 class="rich-link-card-title">hls.jsで実装する動画ストリーミングの分かりやすい解説</h1>
		<p class="rich-link-card-description">
		動画ストリーミングのためのhls.jsの使い方、HLSの概念について分かりやすくまとめた記事です。
		</p>
		<p class="rich-link-href">
		https://mat0401.info/blog/brief-hlsjs1/
		</p>
	</div>
</a></div>

.m3u8 ファイルが videoSrc として指定してやると、ts ファイルを順次読み込んでくれるようだ。

```js
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<video id="video" controls width="640" height="360"></video> 
<script>
var video = document.getElementById('video'); 
var videoSrc = 'https://[動画の配置先]/sample.m3u8'; 
if (Hls.isSupported()) { 
	var hls = new Hls();
	 hls.loadSource(videoSrc); 
	 hls.attachMedia(video); 
} else if (video.canPlayType('application/vnd.apple.mpegurl')) {
	video.src = videoSrc; 
} </script>
```

ここまででわかったのは、動画ファイルをHLS変換してHTTPサーバに配置する静的な配信だ。

ライブストリーミングはどうやるのだ??


[[obs  ライブ配信でOBS を使う]]






## mac に nginx を立ててみる


<div class="rich-link-card-container"><a class="rich-link-card" href="https://github.com/arut/nginx-rtmp-module/wiki/Directives#hls" target="_blank">
	<div class="rich-link-image-container">
		<div class="rich-link-image" style="background-image: url('https://opengraph.githubassets.com/ce9ca3258e82b8e615fcadcb625b5c9c979076d7689df888ceb5383b9c95289a/arut/nginx-rtmp-module')">
	</div>
	</div>
	<div class="rich-link-card-text">
		<h1 class="rich-link-card-title">Directives · arut/nginx-rtmp-module Wiki</h1>
		<p class="rich-link-card-description">
		NGINX-based Media Streaming Server. Contribute to arut/nginx-rtmp-module development by creating an account on GitHub.
		</p>
		<p class="rich-link-href">
		https://github.com/arut/nginx-rtmp-module/wiki/Directives#hls
		</p>
	</div>
</a></div>



<div class="rich-link-card-container"><a class="rich-link-card" href="https://www.xlsoft.com/jp/blog/blog/2019/11/02/post-7858/" target="_blank">
	<div class="rich-link-image-container">
		<div class="rich-link-image" style="background-image: url('https://www.xlsoft.com/jp/blog/wp-content/uploads/2019/11/1_jwaqqgi5dBPVLZ66RyABpQ.jpeg')">
	</div>
	</div>
	<div class="rich-link-card-text">
		<h1 class="rich-link-card-title">RTMP モジュールで Nginx をビデオのストリーミング・ツールとして使用する方法</h1>
		<p class="rich-link-card-description">
		この記事では、インターネットを介してウェブカメラからビデオやオーディオをストリームする際に使用される RTMP (Real Time Messaging Protocol) モジュールを使用して、Nginx をインストール、コンパイル、およびチューニングし、ビデオのストリーミング・ツールとして使用する方法を紹介します。
		</p>
		<p class="rich-link-href">
		https://www.xlsoft.com/jp/blog/blog/2019/11/02/post-7858/
		</p>
	</div>
</a></div>

[[nginx  RTMP モジュール込みで mac に立てる]]


